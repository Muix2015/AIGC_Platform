# AI创意动画体验平台 - 产品需求文档 (PRD)

---

## 1. 修订历史

| 版本 | 日期       | 作者   | 修订说明                                                     |
| :--- | :--------- | :----- | :----------------------------------------------------------- |
| 1.1  | 2025-05-30 | Gemini | 根据用户流程、线框图和高保真原型更新，补充交互细节和具体配置项。 |
| 1.0  | 2025-05-30 | Gemini | 基于原型设计和开发规范创建初始版本                           |

---

## 2. 引言

### 2.1. 项目背景
AI创意动画体验平台是一个面向小学生的AI驱动创意内容创作平台。项目旨在通过技术手段降低动画创作的门槛，提供一个集趣味性、引导性和教育性于一体的在线工具，激发儿童的创造力和想象力。平台采用前后端分离架构，构建了两个核心前端应用：一个为小学生设计的儿童友好创作界面（用户端），以及一个供系统管理员使用的专业技术管理后台（管理端）。

### 2.2. 项目目标
- **赋能创意**: 为小学生提供一个简单、直观、有趣的AI动画创作工具，让他们能够轻松地将自己的想法转化为动画作品。
- **引导式体验**: 通过精心设计的“模板创作”流程，引导用户逐步完成从故事构思到视频合成的全过程，培养结构化创作思维。
- **自由探索**: 提供“自由创作”模式，为有一定基础的用户提供更灵活、独立的创作工具集。
- **技术驱动**: 建立一个稳定、可扩展、易于维护的后端系统，高效集成和管理多种AI服务，支撑内容创作和平台运营。
- **安全教育**: 在创作过程中融入网络安全教育元素，提升儿童的网络素养。

### 2.3. 目标用户
- **主要用户（用户端）**: 小学生（6-12岁）。他们对新鲜事物充满好奇，富有想象力，但可能缺乏专业的创作技能和经验。
- **次要用户（管理端）**: 系统管理员、开发及运维人员。他们需要对平台内容、技术配置和运行状态进行全面的监控和管理。

---

## 3. 总体设计

### 3.1. 设计原则
- **用户端**:
    - **儿童友好**: 界面设计采用温暖色调、圆润的图形、清晰的大图标和简单的交互，营造亲切、有趣的创作氛围。
    - **引导与反馈**: 通过视觉元素（如发光按钮、进度条）和动画效果清晰地引导用户操作，并对每一步操作提供即时、明确的反馈。
    - **未来科技感**: 融合3D悬浮元素、全息投影效果、发光边框等设计，激发儿童对科技的兴趣。
- **管理端**:
    - **专业高效**: 采用左侧导航+主内容区的经典布局，信息架构合理，注重数据展示和操作效率。
    - **技术导向**: 功能设计面向技术管理需求，如API配置、模型参数调整、系统监控等。
    - **数据驱动**: 通过清晰的图表（ECharts）和数据表格直观展示系统状态，辅助决策。
    - **安全可控**: 提供强大的安全管理功能，确保平台内容和数据的安全。

### 3.2. 技术架构
平台采用前后端分离架构，遵循详细的开发规范 (`@django-rules.mdc`, `@vue-rules.mdc`)。
- **后端 (Backend)**:
    - **框架**: Django & Django REST Framework
    - **工作流引擎**: LangGraph，用于编排复杂的AI内容生成流程。
    - **异步任务**: Celery with Redis，处理耗时的AI生成和媒体处理任务。
    - **数据库**: PostgreSQL
    - **实时通信**: Django Channels (WebSocket)，用于向前端推送实时进度和通知。
- **前端 (Frontend)**:
    - **用户端 (frontend-user)**: Vue 3, TypeScript, Pinia, Vue Router, 自定义儿童友好组件库, SCSS。
    - **管理端 (frontend-admin)**: Vue 3, TypeScript, Pinia, Vue Router, Element Plus, ECharts, SCSS。
- **部署**: Docker容器化部署，区分开发、测试、生产环境。

---

## 4. 功能需求 (Functional Requirements)

### 4.1. 通用功能

#### 4.1.1. 用户认证
- **需求描述**:
    - 系统支持“需要登录”和“免登录体验”两种模式，由管理员在后台配置。
    - **注册登录**: 在“需要登录”模式下，用户需注册登录。注册时，用户可从预设的全息头像库中选择头像，并填写昵称、选择年级、设置密码。
    - **免登录体验**: 在此模式下，用户可直接进入创作流程。作品将临时保存在本地（如LocalStorage），并有数量上限（例如3个）。当达到上限时，引导用户注册以永久保存并解锁无限创作。
- **后端实现**:
    - `authentication`应用`User`模型包含`is_guest`等字段。
    - 提供一个系统配置API，用于切换登录模式。
    - API使用JWT进行无状态认证。
- **前端实现**:
    - 启动时请求API判断登录模式。
    - `LoginView.vue`采用未来科技感的UI设计。
    - `useAuth.js`和`auth.js` Pinia store处理认证逻辑。
    - 免登录模式下，在创作大厅显示“注册保存作品”的提示。

### 4.2. 用户端功能

#### 4.2.1. 创作大厅 (Dashboard)
- **需求描述**: 用户进入平台的主界面。
    - **核心操作**: 一个醒目的、有发光动画效果的“开始新的创意动画之旅”按钮。
    - **作品展示**: 以3D悬浮卡片的形式展示用户最近创作的作品，卡片上显示作品缩略图和标题。提供“查看全部作品”的入口。
    - **创作启发**: 设置“创作灵感推荐”或“创作学习”区域，提供故事点子、创作贴士或网络安全小知识，激发用户创作欲望。
- **实现规范**:
    - 页面: `DashboardView.vue`
    - 组件: `WorkCard.vue`, `GlowButton.vue`
    - 状态管理: `works.js` (Pinia store)

#### 4.2.2. 创作流程
##### 4.2.2.1. 创作模式选择 (Mode Selection)
- **需求描述**: 用户点击“开始创作”后，进入此页面。
    - 以两个大型3D悬浮卡片展示“模板创作”和“自由创作”两个选项。
    - “模板创作”卡片突出“AI智能辅助，3分钟快速上手”的特点。
    - “自由创作”卡片突出“无限创意，发挥你的想象力”的特点。
- **实现规范**:
    - 页面: `CreateModeView.vue`
    - 组件: `ModeSelector.vue` (包含3D卡片和悬浮效果)

##### 4.2.2.2. 模板创作流程 (8个步骤)
这是一个线性的、引导式的创作流程，由后端的LangGraph工作流驱动。每一步都有清晰的进度条指示。
1.  **模板配置 (Template Configuration)**
    - **描述**: 用户通过点选卡片的方式选择故事的基本元素。
    - **功能**: 提供故事类型、主人公、场景、艺术风格、故事长度等选项。每个选项都支持“自定义”输入。
    - **实现**: `TemplateConfigView.vue`, `useTemplateCreation.js`
2.  **故事大纲 (Story Outline)**
    - **描述**: AI根据用户配置生成结构化的故事大纲。
    - **功能**: 以卡片列表形式展示AI生成的大纲（如：开端、发展、高潮、结局）。用户可以编辑每个部分的内容，或者点击“重新生成”。
    - **实现**: `StoryOutlineView.vue`, 后端 `generate_outline_node` 工作流节点。
3.  **剧本生成 (Script Generation)**
    - **描述**: AI基于大纲生成详细的分镜头剧本。
    - **功能**: 以“分镜头卡片”列表展示剧本，每个镜头包含场景描述和角色对话。用户可以编辑卡片内容。
    - **实现**: `ScriptGenerationView.vue`, 后端 `generate_script_task` Celery异步任务。
4.  **关键帧设计 (Keyframe Design)**
    - **描述**: AI为每个镜头生成关键画面。
    - **功能**: 在每个“分镜头卡片”内生成关键帧图像。用户可以对不满意的图像进行“局部重绘”或“整体重新生成”。系统需保证角色和场景风格的一致性。
    - **实现**: `KeyframeDesignView.vue`, 后端 `generate_keyframes_node` 工作流节点。
5.  **镜头运动设计 (Camera Movement)**
    - **描述**: 用户为镜头添加动态效果。
    - **功能**: 为每个镜头卡片提供推、拉、摇、移等镜头运动图标选项。提供转场效果（如淡入淡出、切换）选择。
    - **实现**: `CameraMovementView.vue`, 后端 `design_movements_node` 工作流节点。
6.  **视频合成 (Video Synthesis)**
    - **描述**: 后端将所有元素合成为视频。
    - **功能**: 页面中央显示一个带有动画效果的进度条和实时预览窗口。前端通过WebSocket实时更新合成进度。
    - **实现**: `VideoSynthesisView.vue`, 后端 `synthesize_video_node` 工作流节点。
7.  **配音配乐 (Audio Production)**
    - **描述**: 为视频添加声音。
    - **功能**:
        - **AI配音**: 为每个角色的对白行提供文本转语音功能，并允许选择不同音色。
        - **背景音乐**: 提供一个背景音乐库供用户选择。
        - **音量调整**: 允许调整配音和背景音乐的相对音量。
    - **实现**: `AudioProductionView.vue`, 后端 `process_audio_node` 工作流节点。
8.  **作品预览 (Work Preview)**
    - **描述**: 播放最终完成的动画作品。
    - **功能**: 提供一个大尺寸的视频播放器，包含播放/暂停、全屏、音量控制等功能。提供“导出视频”和“分享作品”按钮。
    - **实现**: `WorkPreviewView.vue`

##### 4.2.2.3. 自由创作流程
- **需求描述**: 提供独立的创作工具集，用户可自由选择使用，无固定顺序。
    - **剧本创作**: 一个富文本编辑器，包含主题构思、角色设定、情节规划等模板化区块，辅助用户创作。
    - **图片创作**: 通过文本提示（Prompt）生成图片，提供风格选择和构图设定选项。
    - **视频创作**: 允许用户上传图片或生成图片，通过简单的分镜设计和文本提示生成短视频。
    - **声音合成**: 独立的文本转语音工具，支持音色、语速、语调调节。
- **实现规范**:
    - 入口页面: `FreeCreationView.vue`
    - 各独立页面: `ScriptCreationView.vue`, `ImageCreationView.vue`, etc.
    - 后端需提供独立的API接口支持这些功能。

#### 4.2.3. 作品管理 (Work Management)
- **需求描述**: 用户管理自己创作的所有作品。
- **功能**:
    - 以网格列表形式展示作品卡片。
    - 支持按标题进行模糊搜索。
    - 提供按“创建时间”、“修改时间”排序的功能。
    - 每个作品卡片下有“继续编辑”、“删除”、“分享”的操作按钮。
- **实现规范**:
    - 页面: `WorkManagementView.vue`
    - 组件: `WorkManager.vue`, `ShareModal.vue`
    - 状态管理: `works.js` (Pinia store)

### 4.3. 管理端功能

#### 4.3.1. 系统仪表板 (Admin Dashboard)
- **需求描述**: 管理端首页，提供系统状态的宏观视图。
- **功能**:
    - **关键指标卡片**: 实时展示AI服务状态、今日API调用次数、系统错误率、在线活跃用户数。
    - **快捷操作入口**: 提供到“违规内容审核”、“API接口测试”、“系统配置”、“错误日志”的快速跳转链接。
    - **数据图表**: 使用ECharts展示API调用趋势（折线图）、服务错误率占比（饼图）等。
- **实现规范**:
    - 页面: `AdminDashboardView.vue`
    - 后端: `AdminDashboardViewSet` 提供聚合数据API。
    - 前端: `useDashboard.js` 获取并处理数据。

#### 4.3.2. 内容管理 (Content Management)
- **需求描述**: 管理模板创作中可选择的素材库。
- **功能**:
    - 提供对**场景库**、**角色库**、**风格库**的增删改查管理。
    - 所有列表页均支持搜索、分类筛选和分页。
    - **场景/角色/风格编辑页**: 表单包含详细配置项，如：
        - **通用**: 名称、描述、分类、适用年级。
        - **视觉参数**: 主要色调、光线、特征描述。
        - **提示词配置**: 核心提示词模板、负面提示词、权重参数等。
- **实现规范**:
    - 页面: `ContentManagementView.vue`
    - 后端: `ContentManagementViewSet`, 并为场景、角色、风格创建独立的Model。
    - 前端: 使用Element Plus的`DataTable`和`Form`组件。

#### 4.3.3. 技术配置 (Technical Configuration)
- **需求描述**: 集中管理系统的技术参数和AI服务集成。
- **功能**:
    - **API配置管理**:
        - 以列表形式管理不同的AI服务提供商（如智谱、通义等）。
        - 安全地配置和更新API Key（加密存储，前端不直接显示）。
        - 设置调用策略，如负载均衡和故障转移。
    - **模型参数设置**:
        - 为文本、图像、语音等不同生成任务配置默认模型和高级参数（如Temperature, Top-p, CFG Scale等）。
    - **接口测试**:
        - 提供一个简单的界面，允许管理员选择服务并发送测试请求，以验证连通性和配置正确性。
- **实现规范**:
    - 页面: `TechConfigView.vue`
    - 后端: `SystemConfig` 模型存储配置。
    - 前端: `useSystemConfig.js` 负责配置的读取和更新。

#### 4.3.4. 系统监控 (System Monitoring)
- **需求描述**: 深入监控系统的运行状态和性能。
- **功能**:
    - **API调用日志**: 以数据表格形式展示每一次对外部AI服务的调用，可按服务名称、状态码、时间范围进行筛选和搜索。
    - **性能图表**: 展示API平均响应时间、错误率随时间变化的折线图。
    - **错误日志查看**: 提供查看和搜索后端应用日志的界面。
- **实现规范**:
    - 页面: `SystemMonitorView.vue`
    - 后端: `APICallLog` 模型记录日志，`MonitoringService` 提供统计数据。
    - 前端: `useMonitoring.js` 和 `useWebSocketAdmin.js` 获取实时和历史数据。

#### 4.3.5. 安全设置 (Security Settings)
- **需求描述**: 管理平台的内容安全和访问控制。
- **功能**:
    - **违规词库管理**: 提供一个文本框或文件上传功能，用于维护敏感词库。
    - **内容审核规则**: 配置内容安全检查的策略，例如“启用文本审核”、“启用图像审核”的开关。
    - **用户权限管理**: 管理员列表及权限分配（未来规划）。
- **实现规范**:
    - 页面: `SecuritySettingsView.vue`
    - 后端: `ContentSecurityMiddleware` 在请求处理中进行内容安全检查。

---

## 5. 非功能性需求

### 5.1. 性能
- **响应时间**: API平均响应时间应低于500ms（不含AI生成时间）。页面首次加载时间（FCP）应在2秒以内。
- **前端优化**: 遵循 `@vue-rules`，使用组件懒加载、图片懒加载和压缩、合理使用`v-memo`等优化手段。
- **后端优化**: 遵循 `@django-rules`，使用 `select_related` 和 `prefetch_related` 优化数据库查询，并对高频访问数据实施缓存策略。

### 5.2. 安全
- **输入验证**: 所有来自用户的输入都必须在前端和后端进行严格的验证和清洗。
- **认证授权**: 遵循 `@django-rules`，使用JWT认证，并对敏感操作API进行权限校验。
- **内容安全**: 自动检测用户生成的文本和图片内容，过滤不当信息。
- **API限流**: 对API请求进行速率限制，防止滥用。

### 5.3. 可靠性
- **异步任务**: AI生成等耗时任务必须使用Celery异步处理，并配置失败重试机制。
- **错误处理**: 系统必须有统一的错误处理机制，并记录详细的错误日志，同时向用户展示友好的错误提示。
- **数据备份**: 数据库需要有定期的备份机制。

### 5.4. 可维护性与可测试性
- **代码规范**: 严格遵循 `@django-rules` 和 `@vue-rules` 中定义的命名、格式和结构规范。
- **测试覆盖**: 遵循TDD，单元测试覆盖率不低于80%，关键业务逻辑必须100%覆盖。
- **文档**: 所有公共API和复杂业务逻辑必须有清晰的文档注释。

